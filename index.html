<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chat DB Demo</title>
</head>
<body>
  <h1>Chat Demo (DB)</h1>
  <input id="user" placeholder="Nama kamu">
  <input id="msgInput" placeholder="Tulis pesan...">
  <button onclick="send()">Kirim</button>
  <div id="chat"></div>

  <script>
    async function load() {
      try {
        let res = await fetch('/api/messages');
        let data = await res.json();
        document.getElementById('chat').innerHTML = data
          .map(m => `<p><b>${m.user_name}:</b> ${m.message}</p>`)
          .join('');
      } catch (e) {
        console.error("Error load:", e);
      }
    }

    async function send() {
      let user = document.getElementById('user').value || "Anon";
      let msg = document.getElementById('msgInput').value;

      if (!msg.trim()) return;

      await fetch('/api/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user, msg })
      });

      document.getElementById('msgInput').value = '';
      load();
    }

    load();
    setInterval(load, 3000); // auto-refresh setiap 3 detik
  </script>
</body>
</html>
